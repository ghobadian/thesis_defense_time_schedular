<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1770887376543-1" author="koosha">
        <createTable tableName="admin">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_admin"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-2" author="koosha">
        <createTable tableName="bachelor_student">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_bachelor_student"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-3" author="koosha">
        <createTable tableName="defensemeeting_professor_association">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                             primaryKeyName="pk_defensemeeting_professor_association"/>
            </column>
            <column name="defense_meeting_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="professor_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="score" type="DOUBLE"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-4" author="koosha">
        <createTable tableName="department">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_department"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-5" author="koosha">
        <createTable tableName="field">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_field"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="department_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-6" author="koosha">
        <createTable tableName="master_student">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_master_student"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-7" author="koosha">
        <createTable tableName="phd_student">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_phd_student"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-8" author="koosha">
        <createTable tableName="professor">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_professor"/>
            </column>
            <column name="is_manager" type="BOOLEAN"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-9" author="koosha">
        <createTable tableName="student">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_student"/>
            </column>
            <column name="student_number" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="instructor_id" type="BIGINT"/>
            <column name="graduation_date" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-10" author="koosha">
        <createTable tableName="thesis_defense_meeting">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_thesis_defense_meeting"/>
            </column>
            <column name="thesis_form_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="selected_time_slot_id" type="BIGINT"/>
            <column name="score" type="DOUBLE"/>
            <column name="state" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(255)"/>
            <column name="submission_date" type="DATETIME"/>
            <column name="update_date" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-11" author="koosha">
        <createTable tableName="thesis_form">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_thesis_form"/>
            </column>
            <column name="title" type="VARCHAR(255)"/>
            <column name="abstract_text" type="VARCHAR(255)"/>
            <column name="student_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="instructor_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="submission_date" type="DATETIME"/>
            <column name="instructor_reviewed_at" type="DATETIME"/>
            <column name="admin_reviewed_at" type="DATETIME"/>
            <column name="manager_reviewed_at" type="DATETIME"/>
            <column name="rejection_reason" type="VARCHAR(255)"/>
            <column name="update_date" type="DATETIME"/>
            <column name="field_id" type="BIGINT"/>
            <column name="student_type" type="VARCHAR(255)"/>
            <column name="revision_message" type="VARCHAR(1000)"/>
            <column name="revision_requested_at" type="DATETIME"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-12" author="koosha">
        <createTable tableName="time_slot">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_time_slot"/>
            </column>
            <column name="date" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="time_period" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="defense_meeting_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-13" author="koosha">
        <createTable tableName="timeslot_professor_association">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_timeslot_professor_association"/>
            </column>
            <column name="timeslot_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="professor_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-14" author="koosha">
        <createTable tableName="users">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_users"/>
            </column>
            <column name="first_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="phone_number" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="department_id" type="BIGINT"/>
            <column name="field_id" type="BIGINT"/>
            <column name="enabled" type="BOOLEAN"/>
            <column name="creation_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1770887376543-15" author="koosha">
        <addUniqueConstraint columnNames="name" constraintName="uc_department_name" tableName="department"/>
    </changeSet>
    <changeSet id="1770887376543-16" author="koosha">
        <addUniqueConstraint columnNames="student_number" constraintName="uc_student_student_number"
                             tableName="student"/>
    </changeSet>
    <changeSet id="1770887376543-17" author="koosha">
        <addUniqueConstraint columnNames="thesis_form_id" constraintName="uc_thesis_defense_meeting_thesis_form"
                             tableName="thesis_defense_meeting"/>
    </changeSet>
    <changeSet id="1770887376543-18" author="koosha">
        <addUniqueConstraint columnNames="email" constraintName="uc_users_email" tableName="users"/>
    </changeSet>
    <changeSet id="1770887376543-19" author="koosha">
        <addUniqueConstraint columnNames="phone_number" constraintName="uc_users_phonenumber" tableName="users"/>
    </changeSet>
    <changeSet id="1770887376543-20" author="koosha">
        <addUniqueConstraint columnNames="defense_meeting_id, professor_id"
                             constraintName="uk_defense_meeting_id_professor_id"
                             tableName="defensemeeting_professor_association"/>
    </changeSet>
    <changeSet id="1770887376543-21" author="koosha">
        <addUniqueConstraint columnNames="date, time_period, defense_meeting_id"
                             constraintName="uk_timeslot_date_period_meeting" tableName="time_slot"/>
    </changeSet>
    <changeSet id="1770887376543-22" author="koosha">
        <createIndex indexName="idx_timeslot_date_period_meeting" tableName="time_slot">
            <column name="defense_meeting_id"/>
            <column name="date"/>
            <column name="time_period"/>
        </createIndex>
    </changeSet>
    <changeSet id="1770887376543-23" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="admin" constraintName="FK_ADMIN_ON_ID"
                                 referencedColumnNames="id" referencedTableName="users"/>
    </changeSet>
    <changeSet id="1770887376543-24" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="bachelor_student"
                                 constraintName="FK_BACHELOR_STUDENT_ON_ID" referencedColumnNames="id"
                                 referencedTableName="student"/>
    </changeSet>
    <changeSet id="1770887376543-25" author="koosha">
        <addForeignKeyConstraint baseColumnNames="defense_meeting_id"
                                 baseTableName="defensemeeting_professor_association"
                                 constraintName="FK_DEFENSEMEETING_PROFESSOR_ASSOCIATION_ON_DEFENSE_MEETING"
                                 referencedColumnNames="id" referencedTableName="thesis_defense_meeting"/>
    </changeSet>
    <changeSet id="1770887376543-26" author="koosha">
        <addForeignKeyConstraint baseColumnNames="professor_id" baseTableName="defensemeeting_professor_association"
                                 constraintName="FK_DEFENSEMEETING_PROFESSOR_ASSOCIATION_ON_PROFESSOR"
                                 referencedColumnNames="id" referencedTableName="professor"/>
    </changeSet>
    <changeSet id="1770887376543-27" author="koosha">
        <addForeignKeyConstraint baseColumnNames="department_id" baseTableName="field"
                                 constraintName="FK_FIELD_ON_DEPARTMENT" referencedColumnNames="id"
                                 referencedTableName="department"/>
    </changeSet>
    <changeSet id="1770887376543-28" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="master_student"
                                 constraintName="FK_MASTER_STUDENT_ON_ID" referencedColumnNames="id"
                                 referencedTableName="student"/>
    </changeSet>
    <changeSet id="1770887376543-29" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="phd_student" constraintName="FK_PHD_STUDENT_ON_ID"
                                 referencedColumnNames="id" referencedTableName="student"/>
    </changeSet>
    <changeSet id="1770887376543-30" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="professor" constraintName="FK_PROFESSOR_ON_ID"
                                 referencedColumnNames="id" referencedTableName="users"/>
    </changeSet>
    <changeSet id="1770887376543-31" author="koosha">
        <addForeignKeyConstraint baseColumnNames="id" baseTableName="student" constraintName="FK_STUDENT_ON_ID"
                                 referencedColumnNames="id" referencedTableName="users"/>
    </changeSet>
    <changeSet id="1770887376543-32" author="koosha">
        <addForeignKeyConstraint baseColumnNames="instructor_id" baseTableName="student"
                                 constraintName="FK_STUDENT_ON_INSTRUCTOR" referencedColumnNames="id"
                                 referencedTableName="professor"/>
    </changeSet>
    <changeSet id="1770887376543-33" author="koosha">
        <addForeignKeyConstraint baseColumnNames="selected_time_slot_id" baseTableName="thesis_defense_meeting"
                                 constraintName="FK_THESIS_DEFENSE_MEETING_ON_SELECTEDTIMESLOT"
                                 referencedColumnNames="id" referencedTableName="time_slot"/>
    </changeSet>
    <changeSet id="1770887376543-34" author="koosha">
        <addForeignKeyConstraint baseColumnNames="thesis_form_id" baseTableName="thesis_defense_meeting"
                                 constraintName="FK_THESIS_DEFENSE_MEETING_ON_THESIS_FORM" referencedColumnNames="id"
                                 referencedTableName="thesis_form"/>
    </changeSet>
    <changeSet id="1770887376543-35" author="koosha">
        <addForeignKeyConstraint baseColumnNames="field_id" baseTableName="thesis_form"
                                 constraintName="FK_THESIS_FORM_ON_FIELD" referencedColumnNames="id"
                                 referencedTableName="field"/>
    </changeSet>
    <changeSet id="1770887376543-36" author="koosha">
        <addForeignKeyConstraint baseColumnNames="instructor_id" baseTableName="thesis_form"
                                 constraintName="FK_THESIS_FORM_ON_INSTRUCTOR" referencedColumnNames="id"
                                 referencedTableName="professor"/>
    </changeSet>
    <changeSet id="1770887376543-37" author="koosha">
        <addForeignKeyConstraint baseColumnNames="student_id" baseTableName="thesis_form"
                                 constraintName="FK_THESIS_FORM_ON_STUDENT" referencedColumnNames="id"
                                 referencedTableName="student"/>
    </changeSet>
    <changeSet id="1770887376543-38" author="koosha">
        <addForeignKeyConstraint baseColumnNames="professor_id" baseTableName="timeslot_professor_association"
                                 constraintName="FK_TIMESLOT_PROFESSOR_ASSOCIATION_ON_PROFESSOR"
                                 referencedColumnNames="id" referencedTableName="professor"/>
    </changeSet>
    <changeSet id="1770887376543-39" author="koosha">
        <addForeignKeyConstraint baseColumnNames="timeslot_id" baseTableName="timeslot_professor_association"
                                 constraintName="FK_TIMESLOT_PROFESSOR_ASSOCIATION_ON_TIMESLOT"
                                 referencedColumnNames="id" referencedTableName="time_slot"/>
    </changeSet>
    <changeSet id="1770887376543-40" author="koosha">
        <addForeignKeyConstraint baseColumnNames="defense_meeting_id" baseTableName="time_slot"
                                 constraintName="FK_TIME_SLOT_ON_DEFENSE_MEETING" referencedColumnNames="id"
                                 referencedTableName="thesis_defense_meeting"/>
    </changeSet>
    <changeSet id="1770887376543-41" author="koosha">
        <addForeignKeyConstraint baseColumnNames="department_id" baseTableName="users"
                                 constraintName="FK_USERS_ON_DEPARTMENT" referencedColumnNames="id"
                                 referencedTableName="department"/>
    </changeSet>
    <changeSet id="1770887376543-42" author="koosha">
        <addForeignKeyConstraint baseColumnNames="field_id" baseTableName="users" constraintName="FK_USERS_ON_FIELD"
                                 referencedColumnNames="id" referencedTableName="field"/>
    </changeSet>

</databaseChangeLog>